<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ProductDAO">
	<resultMap id="productResult" type="pro">
		<result property="book_price" column="book_price" />
		<result property="book_remain" column="book_remain" />
		<result property="book_descript" column="book_descript" />
		<result property="book_imgURL" column="book_imgURL" />
		<result property="book_bigimgURL" column="book_bigimgURL" />
		<result property="book_title" column="book_title" />
		<result property="book_points" column="book_points" />
		<result property="book_publish" column="book_publish" />
		<result property="book_publish_date" column="book_publish_date" />
		<result property="book_author" column="book_author" />
		<result property="book_seq" column="book_seq" />
		<result property="book_sellCount" column="book_sellCount" />
		<result property="book_isbn" column="book_isbn" />
		<result property="category_num" column="category_num" />
		<result property="author_seq" column="author_seq" />
	</resultMap>

	<select id="getProductList" resultMap="productResult">
		<![CDATA[SELECT * FROM (SELECT @rownum:=@rownum+1 AS rnum, book.* FROM book,(SELECT @rownum:=0) TMP ) tnum where rnum>0 and rnum<21]]>
	</select>
	<select id="ajax_search" parameterType="pros" resultType="pro">
		<![CDATA[SELECT * FROM (SELECT @rownum:=@rownum+1 AS rnum, book.* FROM book,(SELECT @rownum:=0) TMP]]>
			<trim prefix="WHERE" prefixOverrides="AND | OR">
				<if test="Hsort == '제목'" > AND book_title LIKE CONCAT('%', #{Hthing}, '%')</if>
				<if test="Hsort == '작가'" > AND book_author LIKE CONCAT('%', #{Hthing}, '%')</if>
				<if test="Hsort == '카테고리'" > AND category_num LIKE CONCAT('%', #{Hthing}, '%')</if>
			</trim>
			<![CDATA[) tnum where rnum>=(#{Hpage}*20-19) and rnum<=(#{Hpage}*20)]]>
	</select>
	<select id="all_count" parameterType="pros" resultType="int">
		<![CDATA[SELECT count(*) FROM (SELECT @rownum:=@rownum+1 AS rnum, book.* FROM book,(SELECT @rownum:=0) TMP ) tnum]]>
			<trim prefix="WHERE" prefixOverrides="AND |OR">
			<if test="Hsort == '제목'" > AND book_title LIKE CONCAT('%', #{Hthing}, '%')</if>
			<if test="Hsort == '작가'" > AND book_author LIKE CONCAT('%', #{Hthing}, '%')</if>
			<if test="Hsort == '카테고리'" > AND category_num LIKE CONCAT('%', #{Hthing}, '%')</if>
			</trim>
	</select>

	
</mapper>