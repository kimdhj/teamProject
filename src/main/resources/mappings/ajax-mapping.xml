<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ChatDAO">
	<resultMap type="chat" id="chatResult">
		<result property="sessionid" column="sessionid" />
		<result property="name" column="name" />
		<result property="regdate" column="regdate" />
		<result property="content" column="content" />
		<result property="state" column="state" />
		<result property="num" column="num" />
	</resultMap>
	<select parameterType="map" resultType="chat" id="selectmy">
		<![CDATA[select * from
		real_chat where real_chat_name=#{myname} or real_chat_name=#{adminname} order by real_chat_date asc ]]>
	</select>
	<update id="updatestate" parameterType="chat">
		update real_chat set
		real_chat_state=true where real_chat_name=#{real_chat_name}
	</update>
	<delete parameterType="chat" id="deletename">
		delete from real_chat
		<if test="real_chat_session!=null">
			where real_chat_session=#{real_chat_session}
		</if>
		<if test="real_chat_name!=null">
			where real_chat_name=#{real_chat_name}
		</if>
	</delete>
	<select resultMap="chatResult" id="selectmain">
		select distinct
		real_chat_name,real_chat_session,max(real_chat_date) as real_chat_date,count(case when real_chat_state=false then
		1
		end ) as num from real_chat group by real_chat_name order by num
		desc,real_chat_date desc
	</select>
	<select parameterType="chat" resultType="chat"
		id="selectcontent">
		<![CDATA[	 select
		real_chat_content,real_chat_date,rnum from (select real_chat_content,real_chat_date, @rownum:=@rownum+1 as rnum
		from
		(select real_chat_session,real_chat_content,real_chat_date from real_chat,(select @rownum := 0 ) C
		where
		real_chat_session=#{real_chat_session} order by real_chat_seq desc) B,(select @rownum := 0 ) E) D,(select @rownum := 0 ) F where rnum=1]]>
	</select>
	<select parameterType="chat" resultType="int" id="selectnum">
		select num from
		(
		select
		count(real_chat_state) as num from real_chat where real_chat_state=false and
		real_chat_session=#{real_chat_session}) b
	</select>
	<insert parameterType="chat" id="insertchat">
		insert into real_chat(real_chat_seq,real_chat_session,real_chat_name,real_chat_content,real_chat_date,real_chat_state)
		values(null,#{real_chat_session},#{real_chat_name},#{real_chat_content},CURRENT_TIMESTAMP,false)
	</insert>




</mapper>